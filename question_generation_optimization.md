# 问题生成优化方案

## 当前问题分析

当前的问题生成方式确实存在简单拼凑实体的问题：
1. 机械地使用模板填充实体和关系
2. 缺乏对问题合理性的验证
3. 没有考虑实体间关系的语义合理性
4. 生成的问题可能不符合实际场景

## 优化策略

### 1. 问题合理性验证

#### 1.1 语义合理性检查
- 在生成问题后，使用LLM评估问题的语义合理性
- 检查实体类型与关系类型是否匹配
- 验证问题在实际场景中是否有意义

#### 1.2 上下文一致性验证
- 确保问题与子图的拓扑结构相符
- 验证问题中提到的关系在子图中确实存在
- 检查多跳问题的路径是否连通

### 2. 智能问题生成

#### 2.1 基于语义理解的模板选择
- 不再随机选择模板，而是基于子图的语义特征选择最合适的模板
- 考虑实体类型、关系类型的组合来决定问题类型

#### 2.2 动态问题构造
- 使用LLM理解子图语义后生成自然的问题
- 不完全依赖模板，而是让LLM基于理解生成更灵活的问题

### 3. 问题优化流程

#### 3.1 三阶段生成
1. **初步生成**：基于模板生成候选问题
2. **合理性评估**：使用LLM评估问题的合理性（0-1分数）
3. **优化重写**：对不合理的问题进行重写或丢弃

#### 3.2 评估标准
- **语义合理性**：问题在现实中是否有意义
- **信息完整性**：问题是否包含足够的上下文
- **答案可得性**：基于子图是否能回答该问题
- **语言流畅性**：问题表述是否自然流畅

### 4. 具体实现改进

#### 4.1 添加问题验证器
```python
def validate_question(self, question: str, subgraph: Dict, q_type: str) -> Tuple[bool, float, str]:
    """
    验证问题的合理性
    返回：(是否合理, 合理性分数, 改进建议)
    """
```

#### 4.2 添加问题优化器
```python
def optimize_question(self, question: str, subgraph: Dict, suggestion: str) -> str:
    """
    基于建议优化问题
    """
```

#### 4.3 改进答案生成提示
- 在提示中加入合理性判断
- 让模型在生成答案前先评估问题是否合理
- 对不合理的问题，生成改进版本

### 5. 质量控制机制

#### 5.1 批量验证
- 对生成的问题批量进行合理性评分
- 设置阈值，只保留高质量问题

#### 5.2 迭代优化
- 对低分问题进行重写
- 最多重写2次，仍不合格则丢弃

#### 5.3 多样性保证
- 避免生成过于相似的问题
- 确保不同类型问题的平衡分布

## 预期效果

1. **问题质量提升**：生成的问题更自然、更符合实际场景
2. **减少无效问题**：通过验证机制过滤掉不合理的问题
3. **提高答案质量**：合理的问题能够生成更有价值的答案
4. **增强可解释性**：每个问题都有合理性评分和改进建议