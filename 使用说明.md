# DeepSeek 翻译工具使用说明

## 主要改进

1. **修复了长文档只翻译一部分的问题**
   - 优化了文本分割算法，确保所有内容都被翻译
   - 增加了翻译覆盖率检查，显示翻译完成度

2. **智能文本分割**
   - 优先按段落分割，保持文档结构
   - 对超长段落进行句子级分割
   - 验证分割后内容完整性

3. **更好的用户体验**
   - 可选择分片大小（小/中/大）
   - 实时显示翻译进度和统计信息
   - 翻译完成后显示覆盖率

## 运行方法

### 1. 基本运行
```bash
python translate_deepseek_improved.py
```

### 2. 后台运行（推荐用于大量文件）
```bash
nohup python translate_deepseek_improved.py > translate.log 2>&1 &
```

### 3. 使用 screen 运行（可以断开连接后继续）
```bash
# 创建新的 screen 会话
screen -S translate

# 运行翻译程序
python translate_deepseek_improved.py

# 按 Ctrl+A 然后按 D 来分离会话
# 重新连接：screen -r translate
```

## 使用步骤

1. **选择模型**
   ```
   1. DeepSeek-R1-Distill-Qwen-1.5B (最快)
   2. DeepSeek-R1-Distill-Qwen-7B (推荐)
   3. DeepSeek-R1-Distill-Qwen-14B (高质量)
   4. gte_Qwen2-7B-instruct (备选)
   ```

2. **输入文件夹路径**
   - 输入包含英文txt文件的文件夹路径
   - 例如：`/home/user/english_docs`

3. **输出文件夹路径**
   - 默认为 `./chinese_translations`
   - 可以自定义路径

4. **选择分片大小**
   - 小片段 (800字符) - 更精确但速度慢
   - 中片段 (1500字符) - 平衡选择（推荐）
   - 大片段 (3000字符) - 速度快但可能遗漏

## 输出说明

每个翻译文件包含：
- 文件头部信息（原文件大小、分片数量、翻译时间等）
- 完整的中文翻译内容
- 文件名格式：`原文件名_中文.txt`

## 翻译质量检查

程序会自动计算翻译覆盖率：
- **覆盖率 > 80%**：翻译完整
- **覆盖率 50-80%**：基本完整，可能有少量遗漏
- **覆盖率 < 50%**：会显示警告，建议检查

## 常见问题

### Q: 翻译不完整怎么办？
A: 尝试使用更小的分片大小重新翻译

### Q: 程序中断了怎么办？
A: 程序会跳过已翻译的文件，可以直接重新运行

### Q: 如何提高翻译速度？
A: 使用较小的模型（如1.5B）或增大分片大小

### Q: 内存不足怎么办？
A: 使用较小的模型，或在运行前清理内存：
```bash
# 清理缓存
sync && echo 3 > /proc/sys/vm/drop_caches
```

## 性能参考

- **1.5B模型**：约 500-1000 字符/秒
- **7B模型**：约 200-500 字符/秒
- **14B模型**：约 100-300 字符/秒

## 批量处理建议

对于大量文件（>100个），建议：
1. 使用 screen 或 tmux 运行
2. 选择 7B 模型（平衡质量和速度）
3. 使用中等分片大小
4. 定期检查日志文件

## 监控进度

```bash
# 查看实时输出
tail -f translate.log

# 统计已完成文件
ls chinese_translations/*_中文.txt | wc -l
```